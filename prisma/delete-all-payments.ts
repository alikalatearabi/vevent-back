import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ—‘ï¸  Deleting All Payment Records');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('');

  try {
    // Count payments before deletion
    const paymentCount = await prisma.payment.count();
    console.log(`ğŸ“Š Found ${paymentCount} payment record(s) in the database`);
    console.log('');

    if (paymentCount === 0) {
      console.log('â„¹ï¸  No payments to delete');
      console.log('');
      return;
    }

    // Show payment status breakdown
    const statusBreakdown = await prisma.payment.groupBy({
      by: ['status'],
      _count: true,
    });

    console.log('ğŸ“‹ Payment Status Breakdown:');
    statusBreakdown.forEach(({ status, _count }) => {
      console.log(`   - ${status}: ${_count}`);
    });
    console.log('');

    // Delete all payments
    console.log('ğŸ—‘ï¸  Deleting all payment records...');
    const result = await prisma.payment.deleteMany({});
    
    console.log('');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('âœ… Successfully Deleted All Payments!');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('');
    console.log(`ğŸ“Š Deleted ${result.count} payment record(s)`);
    console.log('');

  } catch (error) {
    console.error('');
    console.error('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.error('âŒ Error during deletion:');
    console.error('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.error(error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

if (require.main === module) {
  main();
}

export { main as deleteAllPayments };

